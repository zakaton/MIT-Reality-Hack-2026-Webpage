<html>
  <head>
    <title>Power Pet</title>
    <script src="./src/utils/gamepad.js"></script>
    <script src="./src/aframe/aframe-master.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/webmidi@latest/dist/iife/webmidi.iife.js"></script>
    <script src="../src/utils/canvasInput.js"></script>
    <script src="../src/aframe/Ticker.js"></script>
    <script src="../src/aframe/poster.js"></script>
    <script src="./src/aframe/occlude-hand-tracking-controls.js"></script>
    <script src="./src/aframe/grabbable-listener.js"></script>
    <script src="./src/aframe/grabbable-anchor.js"></script>
    <script src="./src/aframe/power-pet.js"></script>
    <script src="./src/aframe/robot.js"></script>
    <script src="./src/aframe/recenter-listener.js"></script>
    <script src="./src/aframe/robot-touch-controls.js"></script>
    <script src="./src/socket.io/socket.io.min.js"></script>
    <script src="./src/script.js" type="module"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"
    />
  </head>
  <style>
    .github-fork-ribbon:before {
      background-color: #333;
    }

    #container {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1rem;
    }
    #sceneContainer {
      display: grid;
      aspect-ratio: 1.3;
      height: 500px;
    }
    #sceneContainer > * {
      width: 100%;
      height: 100%;
      grid-area: 1 / 1;
    }
    .aframe-inspector-opened a-scene,
    .aframe-inspector-opened a-scene canvas {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: baseline;
    }
    .containers {
      display: flex;
      flex-direction: column;
    }
    .hidden {
      display: none !important;
    }
  </style>
  <body>
    <a
      class="github-fork-ribbon"
      href="https://github.com/zakaton/MIT-Reality-Hack-2026-Webpage"
      data-ribbon="View on GitHub"
      title="View on GitHub"
      target="_blank"
      >View on GitHub</a
    >
    <h1>Power Pet</h1>
    <div id="container">
      <div id="sceneContainer">
        <img id="sceneBackgroundImage" />
        <video id="sceneBackgroundVideo"></video>
        <video id="sceneBackgroundWebcam"></video>
        <a-scene
          obb-collider="showColliders: false;"
          id="scene"
          embedded
          power-pet="models: #dogModel"
          xr-mode-ui="XRMode: ar"
          light="defaultLightsEnabled: true;"
          grabbable-listener
          device-orientation-permission-ui="enabled: false"
          real-world-meshing="meshMixin: realWorldMeshMixin; meshesEnabled: false; planeMixin: realWorldPlaneMixin; planesEnabled: true; filterLabels: floor, table, wall, ceiling, desk, storage, other, plant, screen, lamp, couch, bed, screen;"
          pool__purrsound="mixin: purrSoundMixin; size: 2; dynamic: true;"
          pool__purrsoundfadeout="mixin: purrFadeOutSoundMixin; size: 2; dynamic: true;"
        >
          <a-assets>
            <a-asset-item
              id="anchorModel"
              src="../assets/3d/anchor.glb"
            ></a-asset-item>
            <a-asset-item
              id="dogModel"
              src="../assets/3d/pets/dog.glb"
            ></a-asset-item>

            <audio
              id="purrAudio"
              src="../assets/audio/purr.wav"
              preload="auto"
            ></audio>
            <a-mixin
              id="purrSoundMixin"
              sound="src: #purrAudio; loop: true;"
            ></a-mixin>

            <audio
              id="purrFadeOutAudio"
              src="../assets/audio/purrFadeOut.wav"
              preload="auto"
            ></audio>
            <a-mixin
              id="purrFadeOutSoundMixin"
              sound="src: #purrFadeOutAudio;"
            ></a-mixin>

            <img id="btsImage" src="../assets/images/bts.webp" />
            <img id="btsLogoImage" src="../assets/images/btsLogo.webp" />
          </a-assets>

          <a-mixin
            id="realWorldPlaneMixin"
            visible="false"
            class="surface"
          ></a-mixin>
          <a-mixin
            id="realWorldMeshMixin"
            visible="false"
            class="surface"
          ></a-mixin>

          <a-light type="ambient"></a-light>

          <a-image
            visible="false"
            poster
            id="btsPoster"
            src="#btsLogoImage"
            position="0 1.2 -0.5"
            height="1"
            width="1.77777"
            scale="0.4 0.4 0.4"
            rotation="0 0 0"
          >
            <a-entity
              power-pet-lookable
              position="-0.103 -0.229 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="0.210 -0.226 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="0.539 -0.219 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="0.578 0.099 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="0.224 0.038 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="-0.074 0.037 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="0.027 0.264 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
            <a-entity
              power-pet-lookable
              position="-0.485 0.316 0.000"
              visible="false"
            >
              <a-sphere color="red" radius="0.05"></a-sphere>
            </a-entity>
          </a-image>

          <a-camera
            id="camera"
            look-controls="enabled: true; magicWindowTrackingEnabled: false;"
            wasd-controls="enabled: true; acceleration: 1;"
            position="0 1.2 0"
            power-pet-lookable
          >
          </a-camera>

          <a-entity
            id="robot"
            class="placeable"
            robot="showDebug: true;"
            rotation="0 180 0"
            position="0 0.8 -0.3"
            anchorable
          >
            <a-entity class="debug" visible="true">
              <a-box
                height="0.0508"
                width="0.1778"
                depth="0.1651"
                position="0 0.0254 0"
                color="red"
              ></a-box>
            </a-entity>

            <a-entity
              data-angle-type="stepper"
              data-angle-index="0"
              data-angle-axis="y"
              data-angle-sign="1"
            >
              <a-entity class="debug" visible="true">
                <a-box
                  height="0.1397"
                  width="0.04445"
                  depth="0.04445"
                  position="0 0.06985 0"
                  color="blue"
                ></a-box>
              </a-entity>

              <a-entity
                position="0 0.1397 0"
                data-angle-type="servo"
                data-angle-index="0"
                data-angle-axis="x"
                data-angle-sign="-1"
                data-angle-offset="10"
              >
                <a-entity class="debug" visible="true">
                  <a-box
                    height="0.12065"
                    width="0.04445"
                    depth="0.04445"
                    position="0 0.060 0"
                    color="green"
                  ></a-box>
                </a-entity>

                <a-entity
                  position="0 0.12065 0"
                  data-angle-type="servo"
                  data-angle-index="1"
                  data-angle-axis="x"
                  data-angle-sign="-1"
                  data-angle-offset="-72"
                >
                  <a-entity class="debug" visible="true">
                    <a-box
                      height="0.0889"
                      width="0.04445"
                      depth="0.04445"
                      position="0 0.04445 0"
                      color="orange"
                    ></a-box>
                  </a-entity>

                  <a-entity position="0 0.0889 0">
                    <a-entity class="debug" visible="true">
                      <a-box
                        height="0.0889"
                        width="0.0889"
                        depth="0.06985"
                        color="purple"
                        visible="true"
                      ></a-box>
                    </a-entity>

                    <a-entity
                      position="0 -0.05 0.01"
                      id="powerPet"
                      power-pet="model: dogModel; showSquashCollider: false; showSquashCenter: false; showSquashControlPoint: false; showLookAt: false; showModelBoundingBox: false;"
                    ></a-entity>
                  </a-entity>
                </a-entity>
              </a-entity>
            </a-entity>
          </a-entity>

          <a-entity
            id="anchor"
            anchored="persistent: true"
            position="0.2 1 -0.3"
            grabbable
            grabbable-anchor
            visible="false"
          >
            <a-entity gltf-model="#anchorModel"></a-entity>
          </a-entity>

          <a-entity
            id="leftController"
            meta-touch-controls="hand: left"
            robot-touch-controls
          >
            <a-entity
              power-pet-lookable
              position="0.006 0 -0.02"
              obb-collider="size: 0.06"
            ></a-entity>
            <a-entity class="text" scale="0.1 0.1 0.1" rotation="-110 0 0">
              <a-text
                value=""
                align="right"
                baseline="top"
                color="black"
              ></a-text>
              <a-plane
                color="white"
                opacity="0.7"
                position="-1.005 -0.450 -0.01"
                width="2"
                height="1"
              ></a-plane>
            </a-entity>
          </a-entity>

          <a-entity
            id="rightController"
            meta-touch-controls="hand: right"
            robot-touch-controls
          >
            <a-entity
              power-pet-lookable
              position="-0.006 0 -0.02"
              obb-collider="size: 0.06"
            ></a-entity>
            <a-entity class="text" scale="0.1 0.1 0.1" rotation="-110 0 0">
              <a-text
                value=""
                align="left"
                baseline="top"
                color="black"
              ></a-text>
              <a-plane
                color="white"
                opacity="0.7"
                position="1.005 -0.450 -0.01"
                width="2"
                height="1"
              ></a-plane>
            </a-entity>
          </a-entity>

          <a-entity
            id="leftHand"
            hand-tracking-grab-controls="hand: left;"
            occlude-hand-tracking-controls
          ></a-entity>
          <a-entity
            id="rightHand"
            hand-tracking-grab-controls="hand: right;"
            occlude-hand-tracking-controls
          ></a-entity>

          <a-sky color="#ECECEC" hide-on-enter-ar></a-sky>
        </a-scene>
      </div>
      <div id="unoQConnectionContainer" class="container">
        <h2>Uno Q Connection</h2>
        <a href="https://powerpet.local:7000" target="_blank">
          test local link
        </a>
        <label>
          address
          <input
            id="unoQAddress"
            size="26"
            type="text"
            placeholder="https://powerpet.local:7000"
          />
        </label>
        <button id="toggleUnoQConnection">connect</button>
        <label>
          auto connect
          <input type="checkbox" id="unoQAutoConnect" disabled />
        </label>
      </div>
      <div id="anglesContainer" class="container">
        <h2>Angles</h2>
        <label>
          <canvas
            id="anglesCanvasInput"
            width="100"
            height="100"
            data-min-x="-180"
            data-max-x="180"
            data-min-y="160"
            data-max-y="0"
            data-input
          ></canvas>
        </label>
        <button id="lockPointer">lock pointer</button>
        <template id="angleTemplate">
          <div class="angle">
            <label>
              <span class="type"></span> <span class="index"></span>
              <input type="number" step="1" />
            </label>
            <input type="range" step="1" />
            <button class="tare hidden">tare</button>
          </div>
        </template>
      </div>
    </div>
  </body>
</html>
